<!DOCTYPE html>
<html>
<head>
    <title>ì‹¤ì‹œê°„ ì•ŒëŒ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body style="text-align: center; padding-top: 50px; font-family: sans-serif;">

    <h2>ì‹¤ì‹œê°„ ì•ŒëŒ í™•ì¸ìš© í”„ë¡œí† íƒ€ì…</h2>
    
    <div id="alarm-container" style="position: relative; display: inline-block; margin-bottom: 30px;">
        <i id="chat-icon" class="fa-regular fa-bell" style="font-size: 50px; color: #ccc; transition: 0.3s;"></i>
        <span id="alarm-dot" style="
            display: none;
            position: absolute;
            top: 0;
            right: 0;
            width: 15px;
            height: 15px;
            background-color: red;
            border-radius: 50%;
            border: 2px solid white;
        "></span>
    </div>

    <p id="status-text">ìƒíƒœ: ì•ŒëŒ ëŒ€ê¸° ì¤‘...</p>

    <hr style="width: 50%; margin: 30px auto;">

    <button onclick="sendSignal()" style="padding: 10px 20px; cursor: pointer; background: #2a52be; color: white; border: none; border-radius: 5px;">
        ì§€ê¸ˆ ë°”ë¡œ ì•ŒëŒ ì˜ê¸° (5ë¶„ ì „ ìƒí™© ê°€ì •)
    </button>

    <script>
        // ğŸ”¹ ì›¹ì†Œì¼“ ì—°ê²°
        const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
        const socket = new WebSocket(protocol + window.location.host + '/ws/notifications/');

        socket.onopen = () => console.log("ì›¹ì†Œì¼“ ì—°ê²° ì„±ê³µ!");

        socket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            console.log("ë°›ì€ ë°ì´í„°:", data);

            if (data.action === "ACTIVATE_5MIN_ALARM") {
                // 1. ë¹¨ê°„ ì  ë³´ì´ê¸°
                document.getElementById('alarm-dot').style.display = 'block';
                // 2. ì•„ì´ì½˜ í™œì„±í™” ìŠ¤íƒ€ì¼
                const icon = document.getElementById('chat-icon');
                icon.classList.replace('fa-regular', 'fa-solid');
                icon.style.color = '#2a52be';
                // 3. í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                document.getElementById('status-text').innerText = "ìƒíƒœ: ğŸ”” ì•ŒëŒì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤!";
            }
        };

        // ğŸ”¹ ë²„íŠ¼ í´ë¦­ ì‹œ ì¥ê³  View í˜¸ì¶œ (ì•ŒëŒ íŠ¸ë¦¬ê±°)
        function sendSignal() {
            fetch('/klub_alram/trigger/')
                .then(response => response.json())
                .then(data => console.log("íŠ¸ë¦¬ê±° ì‹ í˜¸ ë³´ëƒ„:", data));
        }

        // ì•„ì´ì½˜ í´ë¦­ ì‹œ ì´ˆê¸°í™”
        document.getElementById('alarm-container').onclick = function() {
            document.getElementById('alarm-dot').style.display = 'none';
            const icon = document.getElementById('chat-icon');
            icon.classList.replace('fa-solid', 'fa-regular');
            icon.style.color = '#ccc';
            document.getElementById('status-text').innerText = "ìƒíƒœ: ì•ŒëŒ ì½ìŒ (ëŒ€ê¸° ì¤‘)";
        };
    </script>
</body>
</html>